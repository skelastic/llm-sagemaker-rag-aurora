{
 "Resources": {
  "PostgreSQLClientSG1CB4CECF": {
   "Type": "AWS::EC2::SecurityGroup",
   "Properties": {
    "GroupDescription": "security group for postgresql client",
    "GroupName": "postgresql-client-sg",
    "SecurityGroupEgress": [
     {
      "CidrIp": "0.0.0.0/0",
      "Description": "Allow all outbound traffic by default",
      "IpProtocol": "-1"
     }
    ],
    "Tags": [
     {
      "Key": "Name",
      "Value": "postgresql-client-sg"
     }
    ],
    "VpcId": {
     "Fn::ImportValue": "RAGVpcStack:ExportsOutputRefRAGAppVPC19F11A0EF8DC0A5C"
    }
   },
   "Metadata": {
    "aws:cdk:path": "RAGPgVectorStack/PostgreSQLClientSG/Resource"
   }
  },
  "PostgreSQLServerSG2B09A5F2": {
   "Type": "AWS::EC2::SecurityGroup",
   "Properties": {
    "GroupDescription": "security group for postgresql",
    "GroupName": "postgresql-server-sg",
    "SecurityGroupEgress": [
     {
      "CidrIp": "0.0.0.0/0",
      "Description": "Allow all outbound traffic by default",
      "IpProtocol": "-1"
     }
    ],
    "Tags": [
     {
      "Key": "Name",
      "Value": "postgresql-server-sg"
     }
    ],
    "VpcId": {
     "Fn::ImportValue": "RAGVpcStack:ExportsOutputRefRAGAppVPC19F11A0EF8DC0A5C"
    }
   },
   "Metadata": {
    "aws:cdk:path": "RAGPgVectorStack/PostgreSQLServerSG/Resource"
   }
  },
  "PostgreSQLServerSGfromRAGPgVectorStackPostgreSQLServerSGCF18246CALLPORTS3CA28B66": {
   "Type": "AWS::EC2::SecurityGroupIngress",
   "Properties": {
    "Description": "postgresql-server-sg",
    "FromPort": 0,
    "GroupId": {
     "Fn::GetAtt": [
      "PostgreSQLServerSG2B09A5F2",
      "GroupId"
     ]
    },
    "IpProtocol": "tcp",
    "SourceSecurityGroupId": {
     "Fn::GetAtt": [
      "PostgreSQLServerSG2B09A5F2",
      "GroupId"
     ]
    },
    "ToPort": 65535
   },
   "Metadata": {
    "aws:cdk:path": "RAGPgVectorStack/PostgreSQLServerSG/from RAGPgVectorStackPostgreSQLServerSGCF18246C:ALL PORTS"
   }
  },
  "PostgreSQLServerSGfromRAGPgVectorStackPostgreSQLClientSG394D6F935432F4B2DE3F": {
   "Type": "AWS::EC2::SecurityGroupIngress",
   "Properties": {
    "Description": "postgresql-client-sg",
    "FromPort": 5432,
    "GroupId": {
     "Fn::GetAtt": [
      "PostgreSQLServerSG2B09A5F2",
      "GroupId"
     ]
    },
    "IpProtocol": "tcp",
    "SourceSecurityGroupId": {
     "Fn::GetAtt": [
      "PostgreSQLClientSG1CB4CECF",
      "GroupId"
     ]
    },
    "ToPort": 5432
   },
   "Metadata": {
    "aws:cdk:path": "RAGPgVectorStack/PostgreSQLServerSG/from RAGPgVectorStackPostgreSQLClientSG394D6F93:5432"
   }
  },
  "PostgreSQLSubnetGroup": {
   "Type": "AWS::RDS::DBSubnetGroup",
   "Properties": {
    "DBSubnetGroupDescription": "subnet group for postgresql",
    "DBSubnetGroupName": "ragpgvectorstack-aurora-postgresql",
    "SubnetIds": [
     {
      "Fn::ImportValue": "RAGVpcStack:ExportsOutputRefRAGAppVPCPrivateSubnet1SubnetAEDC78DA0859FA39"
     },
     {
      "Fn::ImportValue": "RAGVpcStack:ExportsOutputRefRAGAppVPCPrivateSubnet2SubnetB9256C5AC0B42312"
     },
     {
      "Fn::ImportValue": "RAGVpcStack:ExportsOutputRefRAGAppVPCPrivateSubnet3Subnet63066A5C3CBE8053"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "RAGPgVectorStack/PostgreSQLSubnetGroup/Default"
   }
  },
  "AuroraPostgreSQLClusterParamGroup403E7046": {
   "Type": "AWS::RDS::DBClusterParameterGroup",
   "Properties": {
    "Description": "Custom cluster parameter group for aurora-postgresql15",
    "Family": "aurora-postgresql15",
    "Parameters": {
     "log_min_duration_statement": "15000",
     "default_transaction_isolation": "read committed",
     "client_encoding": "UTF8",
     "rds.allowed_extensions": "*",
     "shared_preload_libraries": "pg_stat_statements,pg_similarity"
    }
   },
   "Metadata": {
    "aws:cdk:path": "RAGPgVectorStack/AuroraPostgreSQLClusterParamGroup/Resource"
   }
  },
  "AuroraPostgreSQLDBParamGroup9C8D4F59": {
   "Type": "AWS::RDS::DBParameterGroup",
   "Properties": {
    "Description": "Custom parameter group for aurora-postgresql15",
    "Family": "aurora-postgresql15",
    "Parameters": {
     "log_min_duration_statement": "15000",
     "default_transaction_isolation": "read committed",
     "rds.allowed_extensions": "*",
     "shared_preload_libraries": "pg_stat_statements,pg_similarity"
    }
   },
   "Metadata": {
    "aws:cdk:path": "RAGPgVectorStack/AuroraPostgreSQLDBParamGroup/Resource"
   }
  },
  "RAGPgVectorStackAuroraPostgresDBClusterSecret45F280C13fdaad7efa858a3daf9490cf0a702aeb": {
   "Type": "AWS::SecretsManager::Secret",
   "Properties": {
    "Description": {
     "Fn::Join": [
      "",
      [
       "Generated by the CDK for stack: ",
       {
        "Ref": "AWS::StackName"
       }
      ]
     ]
    },
    "GenerateSecretString": {
     "ExcludeCharacters": " %+~`#$&*()|[]{}:;<>?!'/@\"\\",
     "GenerateStringKey": "password",
     "PasswordLength": 30,
     "SecretStringTemplate": "{\"username\":\"postgres\"}"
    }
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "RAGPgVectorStack/AuroraPostgresDBCluster/Secret/Resource"
   }
  },
  "AuroraPostgresDBClusterSecretAttachment5D0556AB": {
   "Type": "AWS::SecretsManager::SecretTargetAttachment",
   "Properties": {
    "SecretId": {
     "Ref": "RAGPgVectorStackAuroraPostgresDBClusterSecret45F280C13fdaad7efa858a3daf9490cf0a702aeb"
    },
    "TargetId": {
     "Ref": "AuroraPostgresDBClusterC7942D75"
    },
    "TargetType": "AWS::RDS::DBCluster"
   },
   "Metadata": {
    "aws:cdk:path": "RAGPgVectorStack/AuroraPostgresDBCluster/Secret/Attachment/Resource"
   }
  },
  "AuroraPostgresDBClusterC7942D75": {
   "Type": "AWS::RDS::DBCluster",
   "Properties": {
    "BackupRetentionPeriod": 3,
    "CopyTagsToSnapshot": true,
    "DBClusterParameterGroupName": {
     "Ref": "AuroraPostgreSQLClusterParamGroup403E7046"
    },
    "DBSubnetGroupName": {
     "Ref": "PostgreSQLSubnetGroup"
    },
    "Engine": "aurora-postgresql",
    "EngineVersion": "15.3",
    "MasterUserPassword": {
     "Fn::Join": [
      "",
      [
       "{{resolve:secretsmanager:",
       {
        "Ref": "RAGPgVectorStackAuroraPostgresDBClusterSecret45F280C13fdaad7efa858a3daf9490cf0a702aeb"
       },
       ":SecretString:password::}}"
      ]
     ]
    },
    "MasterUsername": "postgres",
    "Port": 5432,
    "PreferredBackupWindow": "03:00-04:00",
    "VpcSecurityGroupIds": [
     {
      "Fn::GetAtt": [
       "PostgreSQLServerSG2B09A5F2",
       "GroupId"
      ]
     }
    ]
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "RAGPgVectorStack/AuroraPostgresDBCluster/Resource"
   }
  },
  "AuroraPostgresDBClusterWriter94E8F7CB": {
   "Type": "AWS::RDS::DBInstance",
   "Properties": {
    "AutoMinorVersionUpgrade": false,
    "DBClusterIdentifier": {
     "Ref": "AuroraPostgresDBClusterC7942D75"
    },
    "DBInstanceClass": "db.r6g.large",
    "DBParameterGroupName": {
     "Ref": "AuroraPostgreSQLDBParamGroup9C8D4F59"
    },
    "Engine": "aurora-postgresql",
    "PromotionTier": 0,
    "PubliclyAccessible": false
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "RAGPgVectorStack/AuroraPostgresDBCluster/Writer/Resource"
   }
  },
  "AuroraPostgresDBClusterReaderF84F98BA": {
   "Type": "AWS::RDS::DBInstance",
   "Properties": {
    "AutoMinorVersionUpgrade": false,
    "DBClusterIdentifier": {
     "Ref": "AuroraPostgresDBClusterC7942D75"
    },
    "DBInstanceClass": "db.r6g.large",
    "DBParameterGroupName": {
     "Ref": "AuroraPostgreSQLDBParamGroup9C8D4F59"
    },
    "Engine": "aurora-postgresql",
    "PromotionTier": 2,
    "PubliclyAccessible": false
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "RAGPgVectorStack/AuroraPostgresDBCluster/Reader/Resource"
   }
  },
  "CDKMetadata": {
   "Type": "AWS::CDK::Metadata",
   "Properties": {
    "Analytics": "v2:deflate64:H4sIAAAAAAAA/32QQW/CMAyFfwv3NIPuANcBEuI0BLtPbjAlQF1kO5pQlf++QKEChDhZ73vvWYlzOxrZfg/+JHPrfXbwhW1WCm5vEvpt0OVJowvs9TTjOhzNZEPvwZxKRpFoeC2pHApC7ZLT8T1YAEOFinznTw5BEnllPbEpKBQgeG10Or2GUR+2tWJOokAOo5FLRCogKJFt0/7h3GrHD3CJ+qXpEtsKSU0XeHZiNEuUOrDDc+g76DFc4jcazeKk25o+Pu1gYIe9nXifcSD1FdplO/8BYb7ah4YBAAA="
   },
   "Metadata": {
    "aws:cdk:path": "RAGPgVectorStack/CDKMetadata/Default"
   }
  }
 },
 "Outputs": {
  "DBClusterId": {
   "Value": {
    "Ref": "AuroraPostgresDBClusterC7942D75"
   },
   "Export": {
    "Name": "VectorDBClusterId"
   }
  },
  "DBClusterEndpoint": {
   "Value": {
    "Fn::Join": [
     "",
     [
      {
       "Fn::GetAtt": [
        "AuroraPostgresDBClusterC7942D75",
        "Endpoint.Address"
       ]
      },
      ":",
      {
       "Fn::GetAtt": [
        "AuroraPostgresDBClusterC7942D75",
        "Endpoint.Port"
       ]
      }
     ]
    ]
   },
   "Export": {
    "Name": "VectorDBClusterEndpoint"
   }
  },
  "DBClusterReadEndpoint": {
   "Value": {
    "Fn::Join": [
     "",
     [
      {
       "Fn::GetAtt": [
        "AuroraPostgresDBClusterC7942D75",
        "ReadEndpoint.Address"
       ]
      },
      ":",
      {
       "Fn::GetAtt": [
        "AuroraPostgresDBClusterC7942D75",
        "Endpoint.Port"
       ]
      }
     ]
    ]
   },
   "Export": {
    "Name": "VectorDBClusterReadEndpoint"
   }
  },
  "DBSecret": {
   "Value": {
    "Fn::Join": [
     "-",
     [
      {
       "Fn::Select": [
        0,
        {
         "Fn::Split": [
          "-",
          {
           "Fn::Select": [
            6,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "RAGPgVectorStackAuroraPostgresDBClusterSecret45F280C13fdaad7efa858a3daf9490cf0a702aeb"
              }
             ]
            }
           ]
          }
         ]
        }
       ]
      },
      {
       "Fn::Select": [
        1,
        {
         "Fn::Split": [
          "-",
          {
           "Fn::Select": [
            6,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "RAGPgVectorStackAuroraPostgresDBClusterSecret45F280C13fdaad7efa858a3daf9490cf0a702aeb"
              }
             ]
            }
           ]
          }
         ]
        }
       ]
      }
     ]
    ]
   },
   "Export": {
    "Name": "VectorDBSecret"
   }
  },
  "DBClientSecurityGroupId": {
   "Value": {
    "Fn::GetAtt": [
     "PostgreSQLClientSG1CB4CECF",
     "GroupId"
    ]
   },
   "Export": {
    "Name": "VectorDBClientSecurityGroupId"
   }
  },
  "ExportsOutputFnGetAttPostgreSQLClientSG1CB4CECFGroupId5D24BDFF": {
   "Value": {
    "Fn::GetAtt": [
     "PostgreSQLClientSG1CB4CECF",
     "GroupId"
    ]
   },
   "Export": {
    "Name": "RAGPgVectorStack:ExportsOutputFnGetAttPostgreSQLClientSG1CB4CECFGroupId5D24BDFF"
   }
  }
 },
 "Parameters": {
  "BootstrapVersion": {
   "Type": "AWS::SSM::Parameter::Value<String>",
   "Default": "/cdk-bootstrap/hnb659fds/version",
   "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]"
  }
 },
 "Rules": {
  "CheckBootstrapVersion": {
   "Assertions": [
    {
     "Assert": {
      "Fn::Not": [
       {
        "Fn::Contains": [
         [
          "1",
          "2",
          "3",
          "4",
          "5"
         ],
         {
          "Ref": "BootstrapVersion"
         }
        ]
       }
      ]
     },
     "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI."
    }
   ]
  }
 }
}